<!DOCTYPE html>
<html>
<head>
    <title>分布式实时监控中心</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
		<!--easyui-->
	<link rel="stylesheet" type="text/css" href="easyui/themes/default/easyui.css">
	<!-- network -->
		<script src="network/asset/js/esl/esl.js"></script>
		<script src="network/asset/js/codemirror.js"></script>
		<script src="network/asset/js/javascript.js"></script>
        <script src="./asset/js/ScriptEngine.js"></script>
		<link href="network/asset/css/bootstrap.css" rel="stylesheet">
		<link href="network/asset/css/bootstrap-responsive.css" rel="stylesheet">
		<link href="network/asset/css/codemirror.css" rel="stylesheet">
		<link href="network/asset/css/monokai.css" rel="stylesheet">
		<link href="network/asset/css/echartsHome.css" rel="stylesheet">
		<link href="network/asset/css/zTreeStyle.css" rel="stylesheet">
        <link rel="stylesheet" href="network/css/network.css">
    <!-- start: CSS -->
    <link href="assets/css/retina.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles/style.css" />
    <link rel="stylesheet" href="assets/styles/color.css" />
   

    <link rel="stylesheet" href="assets/styles/all.css"/>
	<!--
    <link href="assets/default.css" type="text/css" rel="stylesheet" />
   -->



	<!-- gyy add start-->
	<!-- Basic Styles -->
	<link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" media="screen" href="css/font-awesome.min.css">

	<!-- SmartAdmin Styles : Please note (smartadmin-production.css) was created using LESS variables -->
	<link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-production.css">
	

	
	<!-- Demo purpose only: goes with demo.js, you can delete this css when designing your own WebApp -->
	

	<!-- FAVICONS -->
	<link rel="shortcut icon" href="img/favicon/favicon.ico" type="image/x-icon">
	<link rel="icon" href="img/favicon/favicon.ico" type="image/x-icon">

	<!-- GOOGLE FONT -->
	

	<!-- gyy add end -->

	<style type="text/css">
		.widget-body #site-stats .legend {position: absolute;top: 0px;left: 185px;}
		body{overflow:auto}
	</style>


</head>
<body style="min-width: 1200px; height:100%;background-color:transparent;min-height:519px;overflow:scroll;overflow:hidden;">

		


	<!--tab begin-->

			<div class="easyui-layout" style="width:100%;height:100%;opacity:1;">
				<div data-options="region:'east',split:true"  style="width:16%;height:400px;">

					 <div class="data-tree-2" id="data-network" >
					
							<div class="center-service" style="padding-left:0;height:292px; width:293px;border-radius:0 0 5px 5px;display: block;">
							 <div style="width:10%;height:292px;float:left;margin-bottom:4px;background: url(img/shuxing.png);">
									  <div style="line-height:20px;padding-top:48px;padding-left:5px" id="network-name">属性信息</div>
									   <img src="img/youjiao.png" alt style="margin-top:137px" >
									  <img>
								   </div>
								<table class="table-info" style="border-spacing:0;width:90%;max-width:100%;float:right;background-color: transparent;border-collapse: collapse;">
								
									<tbody>
									   <tr><td style="padding-left: 5px" class="td11">属性</td><td class="td12">属性值</td></tr>
										<tr><td style="padding-left: 5px" class="td21">中心数量</td><td class="td22">3</td></tr>
										<tr><td style="padding-left: 5px" class="td31">当前中心</td><td class="td32">全军信息服务中心(北京)</td></tr>
										<tr><td style="padding-left: 5px" class="td41">主从中心</td><td class="td42">主</td></tr>
										<tr><td style="padding-left: 5px" class="td51">地理位置</td><td class="td52">北京</td></tr>
										<tr><td style="padding-left: 5px" class="td61">存储容量</td><td class="td62">100T</td></tr>
										<tr><td style="padding-left: 5px" class="td71">服务容量</td><td class="td72">100T</td></tr>
									</tbody>
								</table>
							</div>
							<div style="width:10%;height:530px;margin-top:7px;float:left;background: url(img/guzhang.png);">
									 <div style="line-height:20px;padding-top:138px;padding-left:5px;font-weight: bold;">告警信息</div>
									  <img src="img/zuixiaohua.png" alt style="margin-top:248px;margin-left:30%" >
									  <img src="img/zuidahua.png" alt="" >
									  <img src="img/youjiao.png" alt="" >
								   </div>
							<div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-0" data-widget-editbutton="false" style="width:90%;height:545px;top:5px;float:right;">
							
								<div style="height:532px;">

									<!-- widget edit box -->
									
									
									<div class="widget-body" style="height:360px;width:239px !important;">
										
										<table class="table table-bordered" id="addtbody" style="height:350px;width:239px !important;border-collapse: collapse;color: #333;word-break:break-all;word-wrap:break-all;">
											<thead>
												<tr>
													<th style="text-align:center;width:35px;">类型</th>
													<th style="text-align:center;">对象</th>
													<th style="text-align:center;">时间</th>
													
												</tr>
											</thead>
											<tbody >
												

											</tbody>
										</table>

									</div>
									
								</div>
							

							</div>
					</div>
					
				</div>
			<div data-options="region:'west',split:true" style="width:16%;height:400px">
					<div class="easyui-accordion" data-options="fit:true,border:false">
				<div id="tree" class="data-tree">
					<div class="tree-header" >
						<img class="header-icon1" src="./network/image/header-icon.png" alt="icon" width="22" height="22"/><p style="margin-left:68px !important;">节点管理器</p>
						<img class="header-icon2" src="./network/image/header-icon-1.png" alt="icon" width="22" height="22"/>
					</div>
		</div>
				</div>
				</div>
				<div data-options="region:'center'" style="width:68% !important;">
					<div class="easyui-layout" data-options="fit:true">
						<div data-options="region:'north',split:true,border:false" style="height:554px;overflow:scroll;overflow:hidden;">
							<div id="graphic" class="span8" style="width:100% !important;height:100%">
					<canvas id="main" height="390px !important">
					</canvas>
					<div id="smear" style="z-index:10;"></div>
					<div></div>
				</div>
						</div>
						<div data-options="region:'west',split:true,border:false" style="width:35.5%;overflow:hidden;">
						
						
							<!-- row -->
							<div class="row" style="/*width:488px;height:200px;*/width:100%;height:auto;">
                                  <div style="background:url(img/fangwen.png);background-size:cover;width:100%;margin-bottom:1px;height:49px;float:left;">
									 <p id="z1" style="color: #fff;font-size: 15px;left:6px;text-align:center;margin-top:11px;font-weight: bold;">总访问量</p>
								   </div>
								<!-- NEW WIDGET START -->
								<article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                     
									<!-- Widget ID (each widget will need unique ID)-->
									<div class="jarviswidget" id="wid-id-7" data-widget-editbutton="false">
									 

										<div style="height:220px;">

											<!-- widget edit box -->
											<div class="jarviswidget-editbox">
												<!-- This area used as dropdown edit box -->

											</div>
											<!-- end widget edit box -->

											<!-- widget content -->
											<div class="widget-body no-padding">

												<div id="site-stats" class="chart has-legend" style="top: -22px;"></div>

											</div>
										</div>
									</div>
								</article>
							</div>
						</div>
						<div data-options="region:'east',split:true,border:false" style="width:30%;overflow:hidden;">
						
						
							<!-- row -->
							<div class="row" style="/*width:408px;*/width:100%;">
                            <div style="background:url(img/fangwen.png);background-size:cover;width:100%;margin-bottom:1px;height:49px;float:left;">
									 <p style="color: #fff;font-size: 15px;left:6px;text-align:center;margin-top:11px;font-weight: bold;">数据容量</p>
								   </div>
								<!-- NEW WIDGET START -->
								<article class="col-xs-12 col-sm-4 col-md-5 col-lg-5">

									<!-- Widget ID (each widget will need unique ID)-->
									<div class="jarviswidget" id="wid-id-6" data-widget-editbutton="false" style="height:296px;">

										<div style="height:220px">

											<div class="jarviswidget-editbox">
												
											</div>
											
											<div class="widget-body no-padding">

												<div id="pie-chart" class="chart" style="top:-14px;"></div>

											</div>
											<!-- end widget content -->

										</div>
										<!-- end widget div -->

									</div>
									<!-- end widget -->

								</article>
								<!-- WIDGET END -->

							</div>

							<!-- end row -->
						</div>
						<div data-options="region:'center',border:false" style="width:500px;overflow: hidden;">
						
						
							<!-- row -->
							<div class="row" style="/*width:433px;*/height:200px;width:100%;">
                               <div style="background:url(img/fangwen.png);background-size:cover;width:100%;margin-bottom:1px;height:49px;float:left;">
									 <p id="huoyue" style="color: #fff;font-size: 15px;left:6px;text-align:center;margin-top:11px;font-weight: bold;">活跃节点</p>
								   </div>
								<!-- NEW WIDGET START -->
								<article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

									<!-- Widget ID (each widget will need unique ID)-->
									<div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false" style="height:296px">

										<div style="height:220px">

											<!-- widget edit box -->
											<div class="jarviswidget-editbox">
												<!-- This area used as dropdown edit box -->

											</div>
											<!-- end widget edit box -->

											<!-- widget content -->
											<div class="widget-body no-padding">

												<div id="bar-chart" class="chart" style="top:-14px;"></div>

											</div>
											<!-- end widget content -->

										</div>
										<!-- end widget div -->

									</div>
									<!-- end widget -->


								</article>
								<!-- WIDGET END -->

							</div>
						</div>
					</div>
				</div>
	</div>
    

<!-- page scripts -->


		<script type="text/javascript" src="easyui/jquery.min.js"></script>
		<script type="text/javascript" src="easyui/jquery.easyui.min.js"></script>	
		<!-- BOOTSTRAP JS -->
		<script src="js/bootstrap/bootstrap.min.js"></script>


		<!-- MAIN APP JS FILE -->
		<script src="js/app.js"></script>

		<!-- PAGE RELATED PLUGIN(S) -->

		<!-- Flot Chart Plugin: Flot Engine, Flot Resizer, Flot Tooltip -->
		<script src="js/plugin/flot/jquery.flot.cust.js"></script>
		
		
		<script src="js/plugin/flot/jquery.flot.orderBar.js"></script>
		<script src="js/plugin/flot/jquery.flot.pie.js"></script>
		<script src="js/plugin/flot/jquery.flot.tooltip.js"></script>

		<script type="text/javascript" src="network/asset/js/jquery.ztree-all-min.js"></script>
		<script type="text/javascript" src="network/asset/CanvasXpress/js/canvasXpress.min.js"></script>
		<script type="text/javascript" src="network/asset/js/lufylegend.min.js" ></script>
		
<script>
window.onbeforeunload = function() {   
            var n = window.event.screenX - window.screenLeft;   
            var b = n > document.documentElement.scrollWidth-20;   
            if(b && window.event.clientY < 0 || window.event.altKey){   
                if(webSocket) {
                	webSocket.close();
                } 
            }else{
                if(webSocket) {
                	webSocket.close();
                } 
            }
        }
		var nodes1=[], lines1=[], centerip=[];
		var tmpznodes;
		var accnum=0;
		var sysnum=0;
		var interval;//site定时器
		var interval1;//bar定时器
	  	//ztree全局定义
		/*var setting = {
			edit: {
				enable: false,
				editNameSelectAll: true
			},
			data: {
				simpleData: {
					enable: true
				}
			},
			callback: {
				onClick: zTreeOnClick
			}
		};
	  */
		//ztree test data
		var zNode=[];
		
		
       $(document).ready(function(){
	   //alert("sucbiuas");
			$.ajax( {
            type : "GET",
            url : getRootPath() + "/api/v1/ztree/ztree/centernode",
            cache : false,
            async : false,
            success : function(data) {
			
                console.log(data);
			//alert("success");
                addZtreeCenterNode(data);
            },
            error :function(data){
			//alert("faild");
                result= data;
            }
        });
		var setting = {
			edit: {
				enable: false,
				editNameSelectAll: true
			},
			data: {
				simpleData: {
					enable: true
				}
			},
			callback: {
				onClick: zTreeOnClick
			}
		};
	          for(var i=1;i<zNode.length+1;i++){
				var tree_id="#ztree"+i;
				$.fn.zTree.init($(tree_id), setting, zNode[i-1]);
		   }
		   console.log("zNode:");
		   console.log(zNode);
		   
       });
       
       var treeidtmp;
         function addZtreeCenterNode(data){
	  // alert("success");
			var json = eval('(' + data + ')'); 
			console.log("json");
			console.log(json);
			treeidtmp =0;
		//alert(json[0].id+"length"+json.length);

			var setting = {
			edit: {
				enable: false,
				editNameSelectAll: true
			},
			data: {
				simpleData: {
					enable: true
				}
			},
			callback: {
				onClick: zTreeOnClick
			}
		};
			for(var i=1;i<json.length+1;i++){
				if(json[i-1].mainCenter=='1'){
					nodes1.push({
						'id' : 'Level1-'+i,
						'name' : json[i-1].name,
						'group' : 1,
						'shape' : 'image',
						'width' : 100,
						'height' : 100,
						'imagePath' : 'data-center1.png',
						'x':600,
						'y':500,  
						'size':10,
						'address' : json[i-1].address,
						'createtime' : json[i-1].createtime,
						'ip' : json[i-1].id,
						'upip' : json[i-1].upip,
						'maincenter' : json[i-1].mainCenter
					}
					);
				}else{
					nodes1.push({
						'id' : 'Level1-'+i,
						'name' : json[i-1].name,
						'group' : 1,
						'shape' : 'image',
						'width' : 100,
						'height' : 100,
						'imagePath' : 'data-center.png',
						'x':600,
						'y':500,  
						'size':10,
						'address' : json[i-1].address,
						'createtime' : json[i-1].createtime,
						'ip' : json[i-1].id,
						'upip' : json[i-1].upip,
						'maincenter' : json[i-1].mainCenter
					}
					);
				}
			}
			var sequence=[];
			for(var i=0;i<nodes1.length;i++){
				sequence.push(nodes1[i]);
			}
			for(var i=0;i<nodes1.length;i++){
				$.ajax({
					type:"POST",
					url:getRootPath()+"/api/v1/ztree/childnodes?centerIp="+nodes1[i].ip,
					async:false,
					success:function(data){
						if(data=="0"){
							var tsequence=[];
							tsequence.push(nodes1[i]);
							for(var j=0;j<sequence.length;j++){
								if(j==i)
									continue;
								if(j!=i)
									tsequence.push(sequence[j]);
							}
							sequence=[];
							for(var j=0;j<tsequence;j++)
								sequence.push(tsequence[j]);
						}
					},
					error:function(data){
					
					}
				});
			}
			nodes1=[];
			for(var i=0;i<sequence.length;i++){
				nodes1.push(sequence[i]);
			}

			for( var i=0;i<nodes1.length-1;i++)
			{
			//alert(nodes1[i].id);
			for(var j=i+1;j<nodes1.length;j++)
			{
			lines1.push(
			{
				'id1' : nodes1[i].id,
				'id2' : nodes1[j].id,
				'color' : 'rgb(255,0,0)',
				'type' : 'line'
			});
			}
			}
			for(var o in json){
				console.log(json[o].name);
				centerip.push(json[o].id);
				
				var center = '<div class="tree-header2 ztree-center" ><img class="header-icon3" id="img-1" src="./asset/ico/fy.png" alt="icon" width="16" height="19"/>'+'<p style="margin-left:55px;">'+json[o].name+'</p>'+'<img class="header-icon4" id="img-2" src="./image/arrow-2.png" alt="icon" width="16" height="16"/>'
				document.getElementById("tree").innerHTML = document.getElementById("tree").innerHTML +center;
				treeidtmp=treeidtmp+1;
		
				childztree = '<div class="center-service"><div id="ztree'+treeidtmp+'" class="ztree"></div></div>'
				document.getElementById("tree").innerHTML = document.getElementById("tree").innerHTML+childztree;
				var treeId = '#ztree'+treeidtmp;
				
				$.ajax( {
            		type : "POST",
            		url : getRootPath()+"/api/v1/ztree/childnodes?centerIp="+json[o].id,
            		async : false,
            		success : function(data) {
						
                		var zNodes = data;
                		
                		console.log("znode[i]");
                		console.log(data);
						zNode.push(zNodes);
					//	zNode1=data;
						//var tmp=0;
						//var nkl=eval('(' + data + ')');
						//alert("m cds");
						if(zNodes.length>0){
						//alert(zNodes[0].stdname);
						var tmp11 = 0;
						for(var i=0;i<zNodes.length;)
						{
						if(zNodes[i].stdname=="访问节点")
						{
							accnum++;
							nodes1.push({
								'id' : 'Level2-'+accnum,
							  'name' : zNodes[i].name,
							  'group' : 2,
							  'shape' : 'image',
							  'width':100,
							  'height':100,
							  'imagePath':'data-node.png',
							  'x':600,
							  'y':500,
							  'size':10,
							  'address':zNodes[i].address,
							  'createtime':zNodes[i].createtime,
							  'ip':zNodes[i].id,
							  'upip':zNodes[i].upip
							});
							lines1.push({
							'id1' : nodes1[o].id,
							'id2' : 'Level2-'+accnum,
							'color' : 'rgb(255,0,0)',
							'type' : 'line'
							});
							
							for(var j=i+1;j<zNodes.length;j++){
								if(zNodes[j].stdname!="访问节点"){
								sysnum++;
								nodes1.push({
								'id' : 'Level3-'+sysnum,
							  'name' : zNodes[j].name,
							  'group' : 3,
							  'shape' : 'image',
							  'width':100,
							  'height':100,
							  'imagePath':'sys.png',
							  'x':600,
							  'y':500,
							  'size':10,
							  'address':zNodes[j].address,
							  'createtime':zNodes[j].createtime,
							  'ip':zNodes[j].id,
							  'upip':zNodes[j].upip
								});
								lines1.push({
								'id1' : 'Level2-'+accnum,
								'id2' : 'Level3-'+sysnum,
								'color' : 'rgb(255,0,0)',
								'type' : 'line'
								});
								}
								else
								break;
							}
						i=j; 
						}
						}
						
						}
						
						/*
                		$.fn.zTree.init($(treeId), setting, zNodes);
                 	*/},
            		error :function(data){
                		result= data;
            		}
            	});
				    
			}
			
			treerootonclick();
		}
         

         function treerootonclick(){

    /**    	 $('.tree-header2').click(function(){
        		 console.log("go to showtree()");
 				showTree();
 				});*/
 			
 			$('.ztree-center').click(function(){
 			console.log("click ztree center");
 			var text=$(this).text();
 			change_center();
 			for(var i=0;i<nodes1.length;i++){
 				if(text.indexOf(nodes1[i].name)>-1)
 				{
 					clearInterval(interval);
					clearInterval(interval1);
 					changeGrgh(nodes1[i]);
 					changesitestate(nodes1[i]);
 					changelog(nodes1[i]);
 					changebar(nodes1[i]);
 					break;
 				}
 			}
             $(this).next().toggle();
			
		var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			     treeObj.cancelSelectedNode();
				 var treeObj = $.fn.zTree.getZTreeObj("ztree2");
				 treeObj.cancelSelectedNode();
				  var treeObj = $.fn.zTree.getZTreeObj("ztree3");
				 treeObj.cancelSelectedNode();
				 var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
         });
          $(document).ready(function(){
		  $('#ztree1_1').click(function(){
		    console.log("click ztree1_1");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		   $(document).ready(function(){
		  $('#ztree1_3').click(function(){
		    console.log("click ztree1_3");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		   $(document).ready(function(){
		  $('#ztree1_5').click(function(){
		    console.log("click ztree1_5");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree1_7').click(function(){
		    console.log("click ztree1_7");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree1_9').click(function(){
		    console.log("click ztree1_9");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree1_11').click(function(){
		    console.log("click ztree1_11");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree1_13').click(function(){
		    console.log("click ztree1_13");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		   $(document).ready(function(){
		  $('#ztree2_1').click(function(){
		    console.log("click ztree2_1");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree2_3').click(function(){
		    console.log("click ztree2_3");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree2_5').click(function(){
		    console.log("click ztree2_5");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree2_7').click(function(){
		    console.log("click ztree2_7");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree2_9').click(function(){
		    console.log("click ztree2_9");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree2_11').click(function(){
		    console.log("click ztree2_11");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		   $(document).ready(function(){
		  $('#ztree2_13').click(function(){
		    console.log("click ztree2_13");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		   $(document).ready(function(){
		  $('#ztree3_1').click(function(){
		    console.log("click ztree3_1");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		   $(document).ready(function(){
		  $('#ztree3_3').click(function(){
		    console.log("click ztree3_3");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		   $(document).ready(function(){
		  $('#ztree3_5').click(function(){
		    console.log("click ztree3_5");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree3_7').click(function(){
		    console.log("click ztree3_7");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree3_9').click(function(){
		    console.log("click ztree3_9");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree3_11').click(function(){
		    console.log("click ztree3_11");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree3_13').click(function(){
		    console.log("click ztree3_13");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree4_1').click(function(){
		    console.log("click ztree4_1");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree4_3').click(function(){
		    console.log("click ztree4_3");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree4_5').click(function(){
		    console.log("click ztree4_5");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
				 treeObj.cancelSelectedNode();
		  });
		  });
 		$(document).ready(function(){
		  $('#ztree4_7').click(function(){
		    console.log("click ztree4_7");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree4_9').click(function(){
		    console.log("click ztree4_9");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree4_11').click(function(){
		    console.log("click ztree4_11");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
				 treeObj.cancelSelectedNode();
		  });
		  });
		  $(document).ready(function(){
		  $('#ztree4_13').click(function(){
		    console.log("click ztree4_13");
			var text=$(this).text();
			$(this).next().toggle();
			var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree2");
			    treeObj.cancelSelectedNode();
				var treeObj = $.fn.zTree.getZTreeObj("ztree3");
				 treeObj.cancelSelectedNode();
		  });
		  });
 			$('.tree-header3').click(function(){
             	showTree();
        	    });
        	 
         }
		
		var showTree = function(){

			var treeHeader = event.target;
			var treeContent = event.target.nextElementSibling;
			if(treeContent.style.display != ''){
				treeContent.style.display = '';
				treeHeader.style.background = "#263948";
			}else{
			/**	treeContent.style.display = 'block';
				treeHeader.style.background = "#24313e";*/
			}

		}
		function zTreeOnClick(event, treeId, treeNode) {
			console.log("zTreeOnClick");
			document.getElementById("data-network").style.display = 'block';
			document.getElementById("network-name").innerHTML = "基本属性";
			change_access();
			var name=treeNode.name;

			for(var i=0;i<nodes1.length;i++){
				if(name==nodes1[i].name){
					clearInterval(interval);
					clearInterval(interval1);
					changeGrgh(nodes1[i]);
					changesitestate(nodes1[i]);
					changelog(nodes1[i]);
					changebar(nodes1[i]);
					break;
				}
			}
		}
		
		function mainonclick(){
			$('.tree-header').click(function()
					{
					console.log("tree header click00");
					$(".td11").text("属性");
					$(".td12").text("属性值");
					$(".td21").text("中心数量");
					$(".td22").text("3");
					$(".td31").text("当前中心");
					$(".td32").text("全军信息服务中心(北京)");
					$(".td41").text("主从中心");
					$(".td42").text("主");
					$(".td51").text("地理位置");
					$(".td52").text("北京");
					$(".td61").text("存储容量");
					$(".td62").text("100T");
					$(".td71").text("服务容量");
					$(".td72").text("100T");	
					
					clearInterval(interval);
					clearInterval(interval1);
					changeback();
					
					
					
					//console.log("begin canvas");
					console.log(nodes1);
					console.log(lines1);
					$('#container-main').children().remove();
					$('#container-main').remove();
					$('#main').children().remove();
					$('#main').remove();
					var main='<canvas id="main" height="540px !important"  ></canvas>';
					$('#smear').before(main);
					document.getElementById('main').width=graphic.scrollWidth;
					tmpcanvas = new CanvasXpress('main',
					{
						'nodes' : nodes1,
						'edges' : lines1,
						 'legend' : {
				              'nodes' : [],'pos' : {
				                'nodes' : {
				                  'x' : -700,
				                  'y' : -500
				                }
				              }
							 }

					  },

					  {	'backgroundGradient1Color': 'rgba(0,0,0,0)',
						'background':'rgba(0,0,0,0)',
				         // 'backgroundGradient2Color': 'rgba(0,0,0,0)',
				          'gradient': true,
				          'graphType': 'Network',
						  'canvasBoxColor' : 'rgba(0,0,0,0)',
				          'indicatorCenter': 'rainbow',
						  'decorationsPosition': 'top',
				          'nodeFontColor': 'rgb(255,255,255)',
						  'networkLayoutType': 'radial',
				          'showAnimation': false},
						 {

							'dblclick' : function(o, e, t) {
							/*
								var dataTmp = o.nodes[0];
							if(dataTmp.group==1)
								window.parent.addPanel();
								*/
							},
						    'click' : function(o, e, t) {
							/*
						    	var dataTmp = o.nodes[0];
								document.getElementById("data-network").style.display = 'block';
								if(dataTmp.group<3){
								document.getElementById("network-name").innerHTML = "基本信息";
								changeGrgh(dataTmp);
								}
							*/
					 		}
				 		}
					
					);
					 var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			     treeObj.cancelSelectedNode();
				 var treeObj = $.fn.zTree.getZTreeObj("ztree2");
				 treeObj.cancelSelectedNode();
				  var treeObj = $.fn.zTree.getZTreeObj("ztree3");
				 treeObj.cancelSelectedNode();
				 var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
					//location.reload() ;
					});
		}
		
		

		function change_access(){
			$("#z1").html("用户系统请求");
			$("#huoyue").html("节点负荷");		
		}
		
		function change_center(){
			$("#z1").html("访问节点请求");
			$("#huoyue").html("中心负荷");
		}

	
	function changeGrgh( selectedNode){
		console.log(selectedNode);
		console.log(nodes1);
		console.log(lines1);
		$(".td11").text("名称");
		$(".td12").text(selectedNode.name);
		$(".td21").text("地址");
		$(".td22").text(selectedNode.address);
		$(".td31").text("IP：");
		$(".td32").text(selectedNode.ip);
		$(".td41").text("建立时间");
		$(".td42").text(selectedNode.createtime);
		$(".td51").text("主中心节点");
		if(selectedNode.group==1){
			if(selectedNode.maincenter=="1"){
				$(".td52").text("是");
			}
			if(selectedNode.maincenter=="0"){
				$(".td52").text("否");
			}
		}
		if(selectedNode.group!=1){
			$(".td52").text("否");
		}
		$(".td61").text("当前状态");
		$(".td62").text("正常显示");
		$(".td71").text("服务容量");
		$(".td72").text("100T");	
			
		//delete cx2;
		$('#container-main').children().remove();
		$('#container-main').remove();
		$('#main').children().remove();
		$('#main').remove();
		var main='<canvas id="main" height="540px !important"  ></canvas>';
		$('#smear').before(main);
		document.getElementById('main').width=graphic.scrollWidth;			
			//var maincanvas1 = document.getElementById('main1');
		var Midnode=selectedNode;
		var Cnodes=[];
		var Clines=[];
		Cnodes.push(Midnode);
		//alert(Cnodes[2].name);
		if(Midnode.group == 1){
			
			var tmpnodes = [];
			for(var i=0;i<nodes1.length;i++)
			{
				if(nodes1[i].upip == Midnode.ip){
					Cnodes.push(nodes1[i]);
					tmpnodes.push(nodes1[i]);
				}
			}
			for(var j=0;j<tmpnodes.length;j++){
				for( var k=0;k<nodes1.length;k++){
					if(nodes1[k].upip==tmpnodes[j].ip)
						Cnodes.push(nodes1[k]);
				}
			}
			
			for(var i=0;i<lines1.length;i++)
			{
				if(lines1[i].id1.charAt(5)=='1'&&lines1[i].id2.charAt(5)=='2'){
					if(lines1[i].id1==Midnode.id){
						Clines.push(lines1[i]);
						}
				}
				if(lines1[i].id1.charAt(5)=='2'&&lines1[i].id2.charAt(5)=='3'){
					for(var j=0;j<Cnodes.length;j++){
						if((Cnodes[j].id.charAt(5)=='2')&&(Cnodes[j].id==lines1[i].id1)){
						Clines.push(lines1[i]);
						}
					}
				}
			}
			
		}else if(Midnode.group == 2){
			for(var i=0;i<nodes1.length;i++)
			{
				if(nodes1[i].upip == Midnode.ip){
					Cnodes.push(nodes1[i]);
				}
			}

			for(var i=0;i<lines1.length;i++)
			{
				if(lines1[i].id1==Midnode.id){
					if(lines1[i].id1.charAt(5)=='2'&&lines1[i].id2.charAt(5)=='3')
						Clines.push(lines1[i]);		
				}	
			}
		
		}

		console.log(Cnodes);
		console.log(Clines);
	if(Cnodes.length==1){
		Clines.push({
			'id1':Cnodes[0].id,
			'id2':Cnodes[0].id,
			'color':'rgb(255,0,0)',
			'type':'line'
		});
	}

	//delete cx2;
	
	 	tmpcanvas  = new CanvasXpress('main',
	{
		'nodes' :Cnodes,
		
		'edges' : Clines, 
		
		 'legend' : {
              'nodes' : [],'pos' : {
                'nodes' : {
                  'x' : -700,
                  'y' : -500
                }
              }
			 }

	  },

	  {	'backgroundGradient1Color': 'rgba(0,0,0,0)',
		'background':'rgba(0,0,0,0)',
         // 'backgroundGradient2Color': 'rgba(0,0,0,0)',
          'gradient': true,
          'graphType': 'Network',
		  'canvasBoxColor' : 'rgba(0,0,0,0)',
          'indicatorCenter': 'rainbow',
		  'decorationsPosition': 'top',
          'nodeFontColor': 'rgb(255,255,255)',
		  'networkLayoutType': 'radial',
          'showAnimation': false},
		 {

	  'dblclick' : function(o, e, t) {
			//var dataTmp = o.nodes[0];
			//document.getElementById("data-network").style.display = 'block';
			//document.getElementById("network-name").innerHTML = "bvjdviu";
			 
			
	  },
	 
 
  'click' : function(o, e, t) {
	  
			//		var dataTmp = o.nodes[0];
			//document.getElementById("data-network").style.display = 'block';
			//document.getElementById("network-name").innerHTML = "bvjdviu";
			
					}
					}
	);
	
	}

/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////
	
	

	///////////////////////////////////////////////////
	//////////////////////////////////////////////////
	/////////////////////////////////////////////////
	
		function findDataAccess(st, rt) {
			 var se = new ScriptEngine();
			 se.setClass("pku.edu.cn.nodeoperation.NodeOperation");
			 se.setMethod("getNodeInfo");
			 var re = se.invoke(st, rt);
			 return re;
		} 
		function accessCenterNode(){
			var centerNode =  findDataAccess(arguments[0], arguments[1]);
			document.getElementById("data-network").innerHTML = '<div class="tree-header"><img class="header-icon1" src="./image/header-icon.png" 	alt="icon" width="22" height="22"/><span id="network-name">数据中心</span><img class="header-icon2" src="./image/header-icon-1.png" alt="icon" width="22" height="22"/></div><div class="tree-header2" style="padding-left:20px;  width:214px;color:#5489a6;">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;目标&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;目标值</div><div class="center-service"  style="padding-left:20px; width:214px;border-radius:0 0 5px 5px;display: block;"><table class="table-info"><tr><td>1</td><td>IP</td><td>'+centerNode.ip+'</td></tr><tr><td>2</td><td>主从中心</td><td>'+centerNode.centerType+'</td></tr><tr><td>3</td><td>地理位置</td><td>'+centerNode.position+'</td></tr><tr><td>4</td><td>存储容量</td><td>'+centerNode.capacity+'</td></tr><tr><td>5</td><td>服务容量</td><td>'+centerNode.serverCapacity+'</td></tr></table></div>'}
		function accessANode(){
			var ANode =  findDataAccess(arguments[0], arguments[1])
			var html='<div class="tree-header"><img class="header-icon1" src="./image/header-icon.png" alt="icon" width="22" height="22"/><span 	id="network-name">数据访问节点</span><img class="header-icon2" src="./image/header-icon-1.png" alt="icon" width="22" height="22"/></div><div class="tree-header2" style="padding-left:20px;  width:214px;color:#5489a6;">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;目标&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;目标值</div><div class="center-service"  style="padding-left:20px; width:214px;border-radius:0 0 5px 5px;display: block;"><table class="table-info"><tr><td>1</td><td>IP</td><td>'+ANode.ip+'</td></tr><tr><td>2</td><td>访问类型</td><td>'+ANode.type+'</td></tr>';

			var childip=ANode.userIpList;
			for(var i =0;i<childip.length;i++){
			console.log(childip[i]);
			var tmp=i+1;
			var lable = tmp+2;
          	html+= '<tr><td>'+lable+'</td><td>用户系统'+tmp+'</td><td>'+childip[i]+'</td></tr>'
			}			
			html+='</table></div>';
			document.getElementById("data-network").innerHTML = html;
		}
		function accessSysNode(){
			var sysNode =  findDataAccess(arguments[0], arguments[1])
			document.getElementById("data-network").innerHTML = '<div class="tree-header"><img class="header-icon1" src="./image/header-icon.png" alt="icon" width="22" height="22"/><span id="network-name">用户系统</span><img class="header-icon2" src="./image/header-icon-1.png" alt="icon" width="22" height="22"/></div><div class="tree-header2" style="padding-left:20px;  width:214px;color:#5489a6;">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;目标&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;目标值</div><div class="center-service"  style="padding-left:20px; width:214px;border-radius:0 0 5px 5px;display: block;"><table class="table-info"><tr><td>1</td><td>IP</td><td>'+sysNode.ip+'</td></tr><tr><td>2</td><td>所属机构</td><td>'+sysNode.sub+'</td></tr><tr><td>3</td><td>系统类型</td><td>'+sysNode.type+'</td></tr></table></div>';
		}
		
		/**
		* Smearing
		* @param $object 添加拖尾的对象
		*/
		function Smearing($object){
			var self = this;
			base(self,LSprite,[]);
			
			self.x = 687.5000000000001;
			self.y = 406.11164463386166;
			
			self.mode = "";
			
			self.smearingSprite = new LSprite();
			self.addChild(self.smearingSprite);
			
			self.object = $object;
			
			self.originalSprite = new LSprite();
			self.addChild(self.originalSprite);
			self.originalSprite.addChild(self.object);
			
			self.addEventListener(LEvent.ENTER_FRAME,self.smeared);
		}
		Smearing.prototype.smeared = function(self){	
			var smearingChild = new SmearingChild(self.originalSprite,self.object);
			self.smearingSprite.addChild(smearingChild);

			for(var key in self.smearingSprite.childList){
				LTweenLite.to(self.smearingSprite.childList[key],0.5,{
					alpha: 0,
					onComplete:function(o){
						self.smearingSprite.removeChild(o);
					}
				});
			}
		};
		Smearing.prototype.to = function($duration,$vars){	
			var self = this;
			
			$vars.onComplete = function(){
				self.mode = "complete";
			}
			LTweenLite.to(self.originalSprite,$duration,$vars);
		};

		/**
		* SmearingChild
		* @param $parent 确定拖尾位置的对象
		* @param $object 要添加拖尾效果的对象
		*/
		function SmearingChild($parent,$object){
			var self = this;
			base(self,LSprite,[]); 
			
			self.addChild($object);
			
			self.x = $parent.x;
			self.y = $parent.y;
			self.alpha = 0.6;
		}
		
		
		
		function donghua(from,to,color){

			setTimeout(function(){
				init(10,'smear',maincanvas.width,maincanvas.height,main1,LEvent.INIT);
				var backLayer,meteorLayer;
				var back,meteor;
				var maxFrame = 40,indexFrame = 0;
				 var nodes = tmpcanvas.data.nodes;
				 for(var i=0;i<nodes.length;i++){
		                if(from==nodes[i].ip){
		                    var zuobiaox = (tmpcanvas.offsetX + tmpcanvas.data.nodes[i].x) * tmpcanvas.scaleFactor;
		                    var zuobiaoy = (tmpcanvas.offsetY + tmpcanvas.data.nodes[i].y) * tmpcanvas.scaleFactor;
		                }
		                if(to==nodes[i].ip){
		                    var zuobiaox1 = (tmpcanvas.offsetX + tmpcanvas.data.nodes[i].x) * tmpcanvas.scaleFactor;
		                    var zuobiaoy1 = (tmpcanvas.offsetY + tmpcanvas.data.nodes[i].y) * tmpcanvas.scaleFactor;
		                }
		            }
				 function main1(){
						backLayer = new LSprite();
						addChild(backLayer);
						meteorLayer = new LSprite();
						addChild(meteorLayer);
						meteor = new LSprite();
						meteor.graphics.drawArc(0,"#ff0000",[zuobiaox,zuobiaoy,2,0,2*Math.PI],true,"#888000");
						
						meteor1 = new LSprite();
						meteor1.graphics.drawArc(1,"#FFFFFF",[zuobiaox,zuobiaoy,4,0,2*Math.PI],true,"#FFFFFF");
						meteorLayer.addChild(meteor1);
						
						LTweenLite.to(meteor1,1.5,{
							x: zuobiaox1-zuobiaox,
							y: zuobiaoy1-zuobiaoy,
							onComplete:function(o){
								meteorLayer.removeChild(o);
								 removeChild(meteorLayer);
				                    $("#smear").empty();
							}
						});
						meteorLayer.addEventListener(LEvent.ENTER_FRAME,onframe);
						
						var count = 1;
						function onframe(){
							if(count<100){
							var meteor2 = new LSprite();								
							meteor2.graphics.drawArc(2,"rgb(213, 240, 15)",[zuobiaox,zuobiaoy,2-2*count/100,0,2*Math.PI],true,"rgb(213, 240, 15)");
							meteor2.alpha = 1-0.95*count/100;
							meteorLayer.addChild(meteor2);
							LTweenLite.to(meteor2,1.5,{
									alpha:1-0.95*count/100,
									x: zuobiaox1-zuobiaox,
									y: zuobiaoy1-zuobiaoy,
									onComplete:function(o){
										meteorLayer.removeChild(o);
									}
							});
							count ++;
							}
							
						}

					}
				 
				 
			},0);
			
		}
        
		var wsUrl;
		if (window.location.protocol == 'https:') {  
	        wsUrl = 'wss://' + window.location.host + '/monitor/websocket';
		} else {
	        wsUrl = 'ws://' + window.location.host + '/monitor/websocket';
		}
		var cx2;

		var webSocket = 
			new WebSocket(wsUrl);
		
		webSocket.onerror = function(event) {
			onError(event)
		};
		webSocket.onopen = function(event) {
			onOpen(event)
		};
		webSocket.onmessage = function(event) {
			onMessage(event)
		};
		webSocket.onclose = function(event){
			console.log("websocket closed");
		}
		function onOpen(event) {
			webSocket.send('hello');
			console.log("connection conn");
		}
		function onError(event) {
			alert(event.data);
		}

        var tmpcanvas = new Object();

        var graphic = document.getElementById('graphic');
		var maincanvas = document.getElementById('main');
		maincanvas.width = graphic.scrollWidth;

		function onMessage(event) {
			var json = eval('(' + event.data + ')');
			// var json = event.data;
			console.log("onMessage");
			//console.log(json);
			console.log(event.data);
			if(json.addNode){

				
				var node = json.addNode;
				var edge = json.addEdge;
				console.log("add node");
				console.log(node);
				console.log("add edge");
				console.log(edge);
				
				//tmpcanvas.updateData();
				//refresh();
				var setting = {
					edit: {
						enable: false,
						editNameSelectAll: true
					},
					data: {
						simpleData: {
							enable: true
						}
					},
					callback: {
						onClick: zTreeOnClick
					}
				};
				
				if(node.group==2){
					var center = '<div class="tree-header2 ztree-center" ><img class="header-icon3" id="img-1" src="./asset/ico/fy.png" alt="icon" width="16" height="19"/>'+'<p style="margin-left:55px;">'+node.name+'</p>'
					document.getElementById("tree").innerHTML = document.getElementById("tree").innerHTML +center;
					treeidtmp=treeidtmp+1;
					
					childztree = '<div class="center-service"><div id="ztree'+treeidtmp+'" class="ztree"></div></div>'
					document.getElementById("tree").innerHTML = document.getElementById("tree").innerHTML+childztree;
					
					var snode=[];
					snode.push({
						'id' : 'Level1-'+treeidtmp,
						'name' : node.name,
						'group' : 1,
						'shape' : 'image',
						'width' : 100,
						'height' : 100,
						'imagePath' : 'data-center.png',
						'x':600,
						'y':500,
						'size':10,
						'address' : node.phyAddr,
						'createtime' :node.createTime,
						'ip' : node.id,
						'upip' : node.upIpaddr,
						'maincenter': node.mainCenter
					}
					);
					for(var i=0;i<nodes1.length;i++){
						snode.push(nodes1[i]);
					}
					nodes1=[];
					for(var i=0;i<snode.length;i++){
						nodes1.push(snode[i]);
					}
					
					for(var i=1;i<treeidtmp;i++){
						var t1='Level1-'+i;
						var t2='Level1-'+treeidtmp;
						lines1.push({
							'id1':t1,
							'id2':t2,
							'color':'rgb(255,0,0)',
							'type':'line'
						});
						tmpcanvas.addEdge({
							'id1':t1,
							'id2':t2,
							'color':'rgb(255,0,0)',
							'type':'line'
						});
					}
					var nnode={
							'id' : 'Level1-'+treeidtmp,
							'name' : node.name,
							'group' : 1,
							'shape' : 'image',
							'width' : 100,
							'height' : 100,
							'imagePath' : 'data-center.png',
							'x':600,
							'y':500,
							'size':10,
							'address' : node.phyAddr,
							'createtime' :node.createTime,
							'ip' : node.id,
							'upip' : node.upIpaddr
						};
					tmpcanvas.addNode(nnode,tmpcanvas.data);
					tmpcanvas.updateData();
					console.log("canvas");
					console.log(tmpcanvas.nodes);
					console.log(tmpcanvas.data.edges);
					console.log("new nodes1");
					console.log(nodes1);
					console.log("new lines1");
					console.log(lines1);
					console.log("znode");
					console.log(zNode);
					var addznode={};
					//zNode.push(addznode);
					console.log("new znode");
					console.log(zNode);
					for (var i=1;i<zNode.length+1;i++){
						var tree_id="#ztree"+i;
						$.fn.zTree.init($(tree_id),setting,zNode[i-1]);
				   }
					treerootonclick();
					mainonclick();


				}
				
				if(node.group==1){
					
					console.log("zNode");
					console.log(zNode);

					var flag=0;
					for(var i=0;i<zNode.length;i++){
						
						for(var j=0;j<zNode[i].length;j++){
							if(zNode[i][j].upip==node.upIpaddr){
								zNode[i].push({
									'addr' : node.phyAddr,
									'createtime' : node.createTime,
									'icon' : "./asset/img/treeicon/sjfwjd.PNG",
									'id' : node.id,
									'name' : node.name,
									'open' : true,
									'pId' : node.upIpaddr,
									'stdname':"访问节点",
									'upip':node.upIpaddr
								}
								);
								flag=1;
								break;
							}
							
						}			
						
					}
					console.log("flag");
					console.log(flag);
					if(flag==0){
						zNode.push([{
							'addr' : node.phyAddr,
							'createtime' : node.createTime,
							'icon' : "./asset/img/treeicon/sjfwjd.PNG",
							'id' : node.id,
							'name' : node.name,
							'open' : true,
							'pId' : node.upIpaddr,
							'stdname':"访问节点",
							'upip':node.upIpaddr
						}]
						);
					}
					console.log("new zNode");
					console.log(zNode);
							
					//console.log("destroy ztree");
					//$.fn.zTree.destroy();
					console.log("new init ztree");
					for (var i=1;i<zNode.length+1;i++){
						var tree_id="#ztree"+i;
						$.fn.zTree.init($(tree_id), setting, zNode[i-1]);
				   }

					//treerootonclick();
					mainonclick();

					accnum++;
					var leveltmp;
					var leveltmp1='Level2-'+accnum;
					for(var m=0;m<nodes1.length;m++){
						if(edge[0].id2==nodes1[m].ip){
							leveltmp=nodes1[m].id;
						}
					}
					
					nodes1.push({
						'id' : 'Level2-'+accnum,
						'name' : node.name,
						'group' : 2,
						'shape' : 'image',
						'width' : 100,
						'height' : 100,
						'imagePath' : 'data-node.png',
						'x':600,
						'y':500,
						'size':10,
						'address' : node.phyAddr,
						'createtime' :node.createTime,
						'ip' : node.id,
						'upip' : node.upIpaddr
					}
					);
					
					lines1.push({
						'id1':leveltmp,
						'id2':leveltmp1,
						'color':'rgb(255,0,0)',
						'type':'line'
					});
					console.log("new nodes1");
					console.log(nodes1);
					console.log("new lines1");
					console.log(lines1);
					
					var nnode={
							'id' : 'Level2-'+accnum,
							'name' : node.name,
							'group' : 2,
							'shape' : 'image',
							'width' : 100,
							'height' : 100,
							'imagePath' : 'data-node.png',
							'x':600,
							'y':500,
							'size':10,
							'address' : node.phyAddr,
							'createtime' :node.createTime,
							'ip' : node.id,
							'upip' : node.upIpaddr
						};
					var nline={
							'id1':leveltmp,
							'id2':leveltmp1,
							'color':'rgb(255,0,0)',
							'type':'line'
						};
					tmpcanvas.addNode(nnode,tmpcanvas.data);
					tmpcanvas.addEdge(nline);
					tmpcanvas.updateData();
				}
				
				if(node.group==0){

					console.log("zNode");
					console.log(zNode);
					console.log(node);
					console.log(zNode.length);
					var flag=0;
					for(var i=0;i<zNode.length;i++){					
						for(var j=0;j<zNode[i].length;j++){
							console.log(zNode[i][j].upip);
							if(zNode[i][j].upip==node.upIpaddr){
								zNode[i].push({
									'addr' : node.phyAddr,
									'createtime' : node.createTime,
									'icon' : "./asset/img/treeicon/yhxt.PNG",
									'id' : node.id,
									'name' : node.name,
									'open' : true,
									'pId' : node.upIpaddr,
									'stdname':"用户系统",
									'upip':node.upIpaddr
								}
								);
								flag=1;
								break;
							}
							
						}			
						
					}
					console.log("flag");
					console.log(flag);
					if(flag==0){
						for(var i=0;i<zNode.length;i++){					
							for(var j=0;j<zNode[i].length;j++){
								console.log(zNode[i][j].id);
								if(zNode[i][j].id==node.upIpaddr){
									console.log(i);
									console.log(zNode[i][j]);
									zNode[i].push({
										'addr' : node.phyAddr,
										'createtime' : node.createTime,
										'icon' : "./asset/img/treeicon/yhxt.PNG",
										'id' : node.id,
										'name' : node.name,
										'open' : true,
										'pId' : node.upIpaddr,
										'stdname':"用户系统",
										'upip':node.upIpaddr
									}
									);
									flag=1;
									break;
								}
								
							}			
							
						}
					}
					console.log("new flag");
					console.log(flag);
					console.log("new zNode");
					console.log(zNode);
					console.log("new init ztree");
					for (var i=1;i<zNode.length+1;i++){
						var tree_id="#ztree"+i;
						$.fn.zTree.init($(tree_id), setting, zNode[i-1]);
				   }

					//treerootonclick();
					mainonclick();
					sysnum++;
					var leveltmp;
					var leveltmp1='Level3-'+sysnum;
					for(var m=0;m<nodes1.length;m++){
						if(edge[0].id2==nodes1[m].ip){
							leveltmp=nodes1[m].id;
						}
					}
					
					nodes1.push({
						'id' : 'Level3-'+sysnum,
						'name' : node.name,
						'group' : 3,
						'shape' : 'image',
						'width' : 100,
						'height' : 100,
						'imagePath' : 'sys.png',
						'x':600,
						'y':500,
						'size':10,
						'address' : node.phyAddr,
						'createtime' :node.createTime,
						'ip' : node.id,
						'upip' : node.upIpaddr
					}
					);
					
					lines1.push({
						'id1':leveltmp,
						'id2':leveltmp1,
						'color':'rgb(255,0,0)',
						'type':'line'
					});
					console.log("new nodes1");
					console.log(nodes1);
					console.log("new lines1");
					console.log(lines1);
					
					var nnode={
							'id' : 'Level3-'+sysnum,
							'name' : node.name,
							'group' : 3,
							'shape' : 'image',
							'width' : 100,
							'height' : 100,
							'imagePath' : 'sys.png',
							'x':600,
							'y':500,
							'size':10,
							'address' : node.phyAddr,
							'createtime' :node.createTime,
							'ip' : node.id,
							'upip' : node.upIpaddr
						};
					var nline={
							'id1':leveltmp,
							'id2':leveltmp1,
							'color':'rgb(255,0,0)',
							'type':'line'
						};
					tmpcanvas.addNode(nnode,tmpcanvas.data);
					tmpcanvas.addEdge(nline);
					tmpcanvas.updateData();
					
				}

				
			}
			else if(json.mainCenterChanged){
				console.log("进来了");
				var newnodes = tmpcanvas.data.nodes;
				console.log(newnodes);
				var maincenter;
				console.log(json.mainCenterChanged);
				console.log("nodes size is");
				console.log(newnodes.length);
				for(var i = 0;i<newnodes.length;i++){
					if(newnodes[i].group==2){
						console.log("是中心节点 ");
						if(newnodes[i].size==3){
							console.log("原来的主中心");
							console.log(newnodes[i]);
							console.log("现在的size");
							newnodes[i].size=1;
							console.log(newnodes[i]);
						}
						if(newnodes[i].id==json.mainCenterChanged){
							console.log("现在的主中心");
							newnodes[i].size=3;
							console.log(newnodes[i]);
							maincenter=newnodes[i];
						}
					}
				}
				for(var i=0;i<newnodes.length;i++)
				{
					if(newnodes[i].ip==json.mainCenterChanged){
						$(".td11").text("名称");
						$(".td12").text(newnodes[i].name);
						$(".td21").text("地址");
						$(".td22").text(newnodes[i].address);
						$(".td31").text("IP：");
						$(".td32").text(newnodes[i].ip);
						$(".td41").text("建立时间");
						$(".td42").text(newnodes[i].createtime);
						$(".td51").text("主中心节点");
						$(".td52").text("是");
						$(".td61").text("当前状态");
						$(".td62").text("正常显示");
					}	
				}
				
				console.log(tmpcanvas);
				tmpcanvas.updateData();
				//refresh();
				if(maincenter.id){
					accessCenterNode(maincenter.id, maincenter.group,maincenter.size);
				}
			}
			else if(json.log){
				console.log(json);
				var loginfo = json.log;
				console.log("loginfo");
				console.log(loginfo);
				
				if(loginfo.success){
					var sucessinfo = loginfo.success;
					donghua(sucessinfo.localIp,sucessinfo.remoteIp);
					var tr='';				
					tr=tr+'<tr><td class="error" style="color:rgb(0,117,0);width:35px;">'+"日志</td><td>"+loginfo.success.message+"</td><td>"+loginfo.success.time+"</td></tr>";
					document.getElementById("addtbody").innerHTML = tr + document.getElementById("addtbody").innerHTML;
					//$("#addtbody").append(tr);
                    //insertLog(sucessinfo.message);
				}
				else if(loginfo.failure){
					var failureinfo = loginfo.failure;
					var edges = tmpcanvas.data.edges;
					for(var i = 0;i<edges.length;i++){
						if((edges[i].id1==failureinfo.localIp&&edges[i].id2==failureinfo.remoteIp)||(edges[i].id1==failureinfo.remoteIp&&edges[i].id2==failureinfo.localIp)){
							 tmpcanvas.data.edges[i].color = 'rgb(105,105,105)';
				 			 tmpcanvas.updateData();
						}
					}
                    //insertLog(failureinfo.message);
				}
				else{
				}
				
			}
			else if(json.statusChanged){
				console.log("进来了");
				var newnodes = tmpcanvas.data.nodes;
				console.log(newnodes);
				var status=json.statusChanged;
				console.log(json.statusChanged);
				for(var i=0;i<nodes1.length;i++){
					if(nodes1[i].ip==status){
						nodes1[i].imagePath='data-node1.png';
						newnodes[i].imagePath='data-node1.png';
					}
				}
				tmpcanvas.updateData();
			}
			else{
				console.log("in onmessage last else");
				console.log(json);
				console.log("json.edges");
				console.log(json.edges);
				json.nodes=[];
				json.edges=[];
				for(var i=0;i<nodes1.length;i++){
					json.nodes.push(nodes1[i]);
				}
				for(var j=0;j<lines1.length;j++){
					json.edges.push(lines1[j]);
				}
				
				$('#container-main').children().remove();
				$('#container-main').remove();
				$('#main').children().remove();
				$('#main').remove();
				var main='<canvas id="main" height="540px !important"  ></canvas>';
				$('#smear').before(main);
				document.getElementById('main').width=graphic.scrollWidth;	
				
				console.log("new edges");
				console.log(json.edges);
				console.log("nodes1");
				console.log(nodes1);
				console.log("lines1");
				console.log(lines1);
				for(var i=0;i<nodes1.length;i++){
				if(nodes1[i].mainCenter==1){
				cx2 = new CanvasXpress('main',json,
						
			      {'backgroundGradient1Color': 'rgba(0,0,0,0)',
					 'background':'rgba(0,0,0,0)',
         			'backgroundGradient2Color': 'rgba(0,0,0,0)',
          			'gradient': true,
          			'graphType': 'Network',
		  			'canvasBoxColor' : 'transparent',
          			'indicatorCenter': 'rainbow',
		  			'decorationsPosition': 'top',
          			'nodeFontColor': 'rgb(255,0,0)',
		  			'networkLayoutType': 'radial',
          			'showAnimation': false},
					{'click' : function(o, e, t) {
						/*
						if(o.nodes[0].group==0){  //用户系统	
							accessSysNode(o.nodes[0].id,0)}	
						else if(o.nodes[0].group==1){  //数据访问节点	
							accessANode(o.nodes[0].id,1)}
						else { 	//数据中心
							accessCenterNode(o.nodes[0].id,2);}	
						*/
						// var msgBox = document.getElementById('data-network');
						// var closeBtn = document.getElementById('closeButton');
						// closeBtn.onclick=function(){
						// msgBox.style.display = 'none';}
				  	}
			 		}
				);
				}else{
					cx2 = new CanvasXpress('main',json,
						
			      {'backgroundGradient1Color': 'rgba(0,0,0,0)',
					 'background':'rgba(0,0,0,0)',
         			'backgroundGradient2Color': 'rgba(0,0,0,0)',
          			'gradient': true,
          			'graphType': 'Network',
		  			'canvasBoxColor' : 'transparent',
          			'indicatorCenter': 'rainbow',
		  			'decorationsPosition': 'top',
          			'nodeFontColor': 'rgb(255,255,255)',
		  			'networkLayoutType': 'radial',
          			'showAnimation': false},
					{'click' : function(o, e, t) {
						/*
						if(o.nodes[0].group==0){  //用户系统	
							accessSysNode(o.nodes[0].id,0)}	
						else if(o.nodes[0].group==1){  //数据访问节点	
							accessANode(o.nodes[0].id,1)}
						else { 	//数据中心
							accessCenterNode(o.nodes[0].id,2);}	
						*/
						// var msgBox = document.getElementById('data-network');
						// var closeBtn = document.getElementById('closeButton');
						// closeBtn.onclick=function(){
						// msgBox.style.display = 'none';}
				  	}
			 		}
				);
				}
				}
                tmpcanvas = cx2;
		}		
	}
		
	</script>
	
	
	
<script type="text/javascript">
	$(document).ready(function(){
	$('.tree-header').click(function()
	{
	console.log("tree header click1");
	console.log(nodes1);
	console.log(lines1);
	$(".td11").text("属性");
	$(".td12").text("属性值");
	$(".td21").text("中心数量");
	$(".td22").text("3");
	$(".td31").text("当前中心");
	$(".td32").text("全军信息服务中心(北京)");
	$(".td41").text("主从中心");
	$(".td42").text("主");
	$(".td51").text("地理位置");
	$(".td52").text("北京");
	$(".td61").text("存储容量");
	$(".td62").text("100T");
	$(".td71").text("服务容量");
	$(".td72").text("100T");	
	
	
	clearInterval(interval);
	clearInterval(interval1);
	changeback();

	
	$('#container-main').children().remove();
	$('#container-main').remove();
	$('#main').children().remove();
	$('#main').remove();
	var main='<canvas id="main" height="540px !important"  ></canvas>';
	$('#smear').before(main);
	document.getElementById('main').width=graphic.scrollWidth;
	tmpcanvas = new CanvasXpress('main',
	{
		'nodes' : nodes1,
		'edges' : lines1,
		 'legend' : {
              'nodes' : [],'pos' : {
                'nodes' : {
                  'x' : -700,
                  'y' : -500
                }
              }
			 }

	  },

	  {	'backgroundGradient1Color': 'rgba(0,0,0,0)',
		'background':'rgba(0,0,0,0)',
         // 'backgroundGradient2Color': 'rgba(0,0,0,0)',
          'gradient': true,
          'graphType': 'Network',
		  'canvasBoxColor' : 'rgba(0,0,0,0)',
          'indicatorCenter': 'rainbow',
		  'decorationsPosition': 'top',
          'nodeFontColor': 'rgb(255,255,255)',
		  'networkLayoutType': 'radial',
          'showAnimation': false},
		 {

			'dblclick' : function(o, e, t) {
			/*
				var dataTmp = o.nodes[0];
				if(dataTmp.group==1)
				window.parent.addPanel();
				*/
				
			},
		    'click' : function(o, e, t) {
			/*
		    	var dataTmp = o.nodes[0];
			document.getElementById("data-network").style.display = 'block';
			if(dataTmp.group<3){
			document.getElementById("network-name").innerHTML = "基本信息";
			changeGrgh(dataTmp);
			}
			*/
	 		}
 		}
	);
	 var treeObj = $.fn.zTree.getZTreeObj("ztree1");
			     treeObj.cancelSelectedNode();
				 var treeObj = $.fn.zTree.getZTreeObj("ztree2");
				 treeObj.cancelSelectedNode();
				  var treeObj = $.fn.zTree.getZTreeObj("ztree3");
				 treeObj.cancelSelectedNode();
				 var treeObj = $.fn.zTree.getZTreeObj("ztree4");
				 treeObj.cancelSelectedNode();
	//location.reload() ;
	});
	});
    </script>
	
	
		<script type="text/javascript">
			// PAGE RELATED SCRIPTS

			/* chart colors default */
			var $chrt_border_color = "#efefef";
			var $chrt_grid_color = "#DDD"
			var $chrt_main = "#E24913";
			/* red       */
			var $chrt_second = "#6595b4";
			/* blue      */
			var $chrt_third = "#FF9F01";
			/* orange    */
			var $chrt_fourth = "#7e9d3a";
			/* green     */
			var $chrt_fifth = "#BD362F";
			/* dark red  */
			var $chrt_mono = "#000";
			
			var tmpseletnode;

			$(document).ready(function() {

				// DO NOT REMOVE : GLOBAL FUNCTIONS!
				pageSetUp();

				

				/* bar chart */

				if ($("#bar-chart").length) {
					interval1=setInterval("showbar()", 2000);		
				}

				/* end bar chart */

				/* pie chart */

				if ($('#pie-chart').length) {

					$.ajax( {
						type : "GET",
						url : getRootPath() + "/api/v1/ztree/ztree/piechart",
						cache : false,
						async : false,
						success : function(data) {
							var json = eval('(' + data + ')'); 
							
							var tmp1 = new Array();
							var tmp2 = new Array();
							tmp1 = json[0].split("/");
							tmp2 = json[1].split("/");
							var data_pie = [];
							for(var i = 0; i < tmp1.length; i++){
								data_pie[i] = {
									label : tmp1[i],
									data : tmp2[i]
								}
							}

					$.plot($("#pie-chart"), data_pie, {
								series : {
									pie : {
										show : true,
										innerRadius : 0.4,
										radius : 1,
										label : {
											show : true,
											radius : 2/ 3,
											formatter : function(label, series) {
												return '<div style="font-size:11px;text-align:center;padding:4px;color:white;" title="'+ label +'">' + label.substring(0,4) + '<br/>' + Math.round(series.percent) + '%</div>';
											},
											threshold : 0.05
										}
									}
								},
								legend : {
									show : true,
									noColumns : 1, // number of colums in legend table
									labelFormatter : null, // fn: string -> string
									labelBoxBorderColor : "#000", // border color for the little label boxes
									container : null, // container (as jQuery object) to put legend in, null means default on top of graph
									position : "ne", // position of default legend container within plot
									margin : [5, 10], // distance from grid edge to default legend container within plot
									backgroundColor : "#efefef", // null means auto-detect
									backgroundOpacity : 1 // set to 0 to avoid background
								},
								grid : {
									hoverable : true,
									clickable : true
								},
					});
                    },
						error :function(data){
						
						}
					});
				}

				/* end pie chart */

				/* site stats chart */

				if ($("#site-stats").length) {
          /**         console.log("site stats ");*/
					interval=setInterval("showsite()", 2000);	
				}

				/* end site stats */
				
				
				if ($("#addtbody").length) {
				
					$.ajax( {
			            type : "GET",
			            url : getRootPath() + "/api/v1/ztree/ztree/loginfo",
			            cache : false,
			            async : false,
			            success : function(data) {
						var json = eval('(' + data + ')'); 
							//var tr = '<tr><td>'+json[0]+'</td><td>'+json[1]+'</td><td>'+json[2]+'</td></tr>';
							var tr='';
							for(var i=0;i<json.length;i++){
								if((i+1)%3==0){
									tr=tr+"<td>"+json[i]+'</td></tr>'
								}
								if((i+1)%3==1){
									if(json[i]=="故障"){
										tr=tr+'<tr><td class="error" style="color:rgb(255,0,0);width:35px;">'+json[i]+'</td>';
									}else{if(json[i]=="日志"){
										tr=tr+'<tr><td class="error" style="color:rgb(0,117,0);width:35px;">'+json[i]+'</td>';
									}else{if(json[i]=="告警"){
										tr=tr+'<tr><td class="error" style="color:rgb(0,181,0);width:35px;">'+json[i]+'</td>';
									}}}
								}
								if((i+1)%3==2){
									tr=tr+'<td>'+json[i]+'</td>';
								}
							}
							
							$("#addtbody").append(tr);
						}
					});
				}


			});

			function showsite(){
				//console.log("site stats ");
				$.ajax( {
						type : "GET",
						url : getRootPath() + "/api/v1/ztree/ztree/statechart",
						cache : false,
						async : false,
						success : function(data) {
						
							var json = eval('(' + data + ')'); 
							//console.log("site stats success");
							var tmp = new Array();
							var length=json[0];
							tmp = json[length+1].split("/");
							var t=[];
							for(var i=0;i<length;i++){
								var temp=new Array();
								temp=json[length+2+i].split("/");
								var num=[];
								for(var j=0;j<tmp.length;j++){
									num.push([parseInt(tmp[j]),parseInt(temp[j])]);
								}								
								var obj={};
								obj.data=num;
								obj.label=json[i+1];
								t.push(obj);
							}

					var plot = $.plot($("#site-stats"), t, {
						series : {
							lines : {
								show : true,
								lineWidth : 1,
								fill : true,
								fillColor : {
									colors : [{
										opacity : 0.1
									}, {
										opacity : 0.15
									}]
								}
							},
							points : {
								show : true
							},
							shadowSize : 0
						},
						xaxis : {
							mode : "time",
							tickLength : 10
						},

						yaxes : [{
							min : 0,
							tickLength : 5
						}],
						grid : {
							hoverable : true,
							clickable : true,
							tickColor : $chrt_border_color,
							borderWidth : 0,
							borderColor : $chrt_border_color,
						},
						tooltip : true,
						tooltipOpts : {
							content : "%s for <b>%x:00 hrs</b> was %y",
							dateFormat : "%y-%0m-%0d",
							defaultTheme : false
						},
						colors : [$chrt_main, $chrt_second],
						xaxis : {
							ticks : 15,
							tickDecimals : 2
						},
						yaxis : {
							ticks : 15,
							tickDecimals : 0
						},
					});
                    },
						error :function(data){
						
						}
					});
			}
			
				function showbar(){
				//console.log("bar stats ");
					$.ajax( {
			            type : "GET",
			            url : getRootPath() + "/api/v1/ztree/ztree/barchart",
			            cache : false,
			            async : false,
			            success : function(data) {
							
							var json = eval('(' + data + ')'); 
							var tmp = new Array();
							var length=json[0];
							tmp = json[length+1].split("/");
							var t=[];
							for(var i=0;i<length;i++){
								var temp=new Array();
								temp=json[length+2+i].split("/");
								var num=[];
								for(var j=0;j<tmp.length;j++){
									num.push([parseInt(tmp[j]),parseInt(temp[j])]);
								}	
								
								var bar={};
								bar.show=true;
								bar.barWidth=0.5;
								bar.order=i;
								
								var obj={};
								obj.data=num;
								obj.bars=bar;
								t.push(obj);
							}
					//Display graph
					$.plot($("#bar-chart"), t, {
						colors : [$chrt_second, $chrt_fourth, "#666", "#BBB"],
						grid : {
							show : true,
							hoverable : true,
							clickable : true,
							tickColor : $chrt_border_color,
							borderWidth : 0,
							borderColor : $chrt_border_color,
						},
						legend : true,
						tooltip : true,
						tooltipOpts : {
							content : "<b>%x</b> = <span>%y</span>",
							defaultTheme : false
						}

					});
                      },
			            error :function(data){
							console.log("failed");
							console.log(data);
			            }
			        });
				
				}
			
			function changesitestate(selectnode){
				tmpselectnode=selectnode;
				interval=setInterval("showsitechange()", 2000);	
			}
			
			function showsitechange(){
				//console.log("changesite");
				//console.log(tmpselectnode);
				if ($("#site-stats").length) {
					$.ajax( {
						type : "GET",
						url : getRootPath() + "/api/v1/ztree/ztree/changestatechart?ip="+tmpselectnode.ip+"&group="+tmpselectnode.group+"&upip="+tmpselectnode.upip+"&name="+tmpselectnode.name,
						cache : false,
						async : false,
						success : function(data) {
						
							var json = eval('(' + data + ')'); 
							var tmp = new Array();
							var length=json[0];
							tmp = json[length+1].split("/");
							var t=[];
							for(var i=0;i<length;i++){
								var temp=new Array();
								temp=json[length+2+i].split("/");
								var num=[];
								for(var j=0;j<tmp.length;j++){
									num.push([parseInt(tmp[j]),parseInt(temp[j])]);
								}								
								var obj={};
								obj.data=num;
								obj.label=json[i+1];
								t.push(obj);
							}

					var plot = $.plot($("#site-stats"), t, {
						series : {
							lines : {
								show : true,
								lineWidth : 1,
								fill : true,
								fillColor : {
									colors : [{
										opacity : 0.1
									}, {
										opacity : 0.15
									}]
								}
							},
							points : {
								show : true
							},
							shadowSize : 0
						},
						xaxis : {
							mode : "time",
							tickLength : 10
						},

						yaxes : [{
							min : 0,
							tickLength : 5
						}],
						grid : {
							hoverable : true,
							clickable : true,
							tickColor : $chrt_border_color,
							borderWidth : 0,
							borderColor : $chrt_border_color,
						},
						tooltip : true,
						tooltipOpts : {
							content : "%s for <b>%x:00 hrs</b> was %y",
							dateFormat : "%y-%0m-%0d",
							defaultTheme : false
						},
						colors : [$chrt_main, $chrt_second],
						xaxis : {
							ticks : 15,
							tickDecimals : 2
						},
						yaxis : {
							ticks : 15,
							tickDecimals : 0
						},
					});
                    },
						error :function(data){
						
						}
					});
				
				}
			}
			
			function changebar(selectnode){
				tmpselectnode=selectnode;
				interval1=setInterval("showbarchange()", 2000);	
			}
			
			function showbarchange(){
				//console.log("changebar");
				//console.log(tmpselectnode);
				if ($("#bar-chart").length) {
				
					$.ajax( {
			            type : "GET",
			            url : getRootPath() + "/api/v1/ztree/ztree/changebar?ip="+tmpselectnode.ip+"&group="+tmpselectnode.group+"&name="+tmpselectnode.name,
			            cache : false,
			            async : false,
			            success : function(data) {
							
							var json = eval('(' + data + ')'); 
							var tmp = new Array();
							var length=json[0];
							tmp = json[length+1].split("/");
							var t=[];
							for(var i=0;i<length;i++){
								var temp=new Array();
								temp=json[length+2+i].split("/");
								var num=[];
								for(var j=0;j<tmp.length;j++){
									num.push([parseInt(tmp[j]),parseInt(temp[j])]);
								}	
								
								var bar={};
								bar.show=true;
								bar.barWidth=0.5;
								bar.order=i;
								
								var obj={};
								obj.data=num;
								obj.bars=bar;
								t.push(obj);
							}
					//Display graph
					$.plot($("#bar-chart"), t, {
						colors : [$chrt_second, $chrt_fourth, "#666", "#BBB"],
						grid : {
							show : true,
							hoverable : true,
							clickable : true,
							tickColor : $chrt_border_color,
							borderWidth : 0,
							borderColor : $chrt_border_color,
						},
						legend : true,
						tooltip : true,
						tooltipOpts : {
							content : "<b>%x</b> = <span>%y</span>",
							defaultTheme : false
						}

					});
                      },
			            error :function(data){
							console.log("failed");
							console.log(data);
			            }
			        });
					
					
				}
			}
			
			function changelog(selectnode){
				if ($("#addtbody").length) {
					var t=document.getElementById("addtbody");

					var rowNum=t.rows.length;
					for(var i=1;i<rowNum;i++){
						t.deleteRow(i);
						rowNum=rowNum-1;
						i=i-1;
					}
					$.ajax( {
			            type : "GET",
			            url : getRootPath() + "/api/v1/ztree/ztree/changelog?ip="+selectnode.ip,
			            cache : false,
			            async : false,
			            success : function(data) {
						var json = eval('(' + data + ')'); 
							//var tr = '<tr><td>'+json[0]+'</td><td>'+json[1]+'</td><td>'+json[2]+'</td></tr>';
							var tr='';
							for(var i=0;i<json.length;i++){
								if((i+1)%3==0){
									tr=tr+"<td>"+json[i]+'</td></tr>'
								}
								if((i+1)%3==1){
								if(json[i]=="故障"){
										tr=tr+'<tr><td class="error" style="color:rgb(255,0,0);width:35px;">'+json[i]+'</td>';
									}else{if(json[i]=="日志"){
										tr=tr+'<tr><td class="error" style="color:rgb(0,117,0);width:35px;">'+json[i]+'</td>';
									}else{if(json[i]=="告警"){
										tr=tr+'<tr><td class="error" style="color:rgb(0,181,0);width:35px;">'+json[i]+'</td>';
									}}}
								}
								if((i+1)%3==2){
									tr=tr+'<td>'+json[i]+'</td>';
								}
							}
							
							$("#addtbody").append(tr);
						}
					});
				}
				 
			}
			
			function changeback(){
				/* bar chart */

				$("#z1").html("总访问量");
				$("#huoyue").html("活跃节点");	
				
				if ($("#addtbody").length) {
					var t=document.getElementById("addtbody");

					var rowNum=t.rows.length;
					for(var i=1;i<rowNum;i++){
						t.deleteRow(i);
						rowNum=rowNum-1;
						i=i-1;
					}
					$.ajax( {
			            type : "GET",
			            url : getRootPath() + "/api/v1/ztree/ztree/loginfo",
			            cache : false,
			            async : false,
			            success : function(data) {
						console.log("loginfo success!");
						var json = eval('(' + data + ')'); 

							//var tr = '<tr><td>'+json[0]+'</td><td>'+json[1]+'</td><td>'+json[2]+'</td></tr>';
							var tr='';
							for(var i=0;i<json.length;i++){
								if((i+1)%3==0){
									tr=tr+"<td>"+json[i]+'</td></tr>'
								}
								if((i+1)%3==1){
									if(json[i]=="故障"){
										tr=tr+'<tr><td class="error" style="color:rgb(255,0,0);width:35px;">'+json[i]+'</td>';
									}else{if(json[i]=="日志"){
										tr=tr+'<tr><td class="error" style="color:rgb(0,117,0);width:35px;">'+json[i]+'</td>';
									}else{if(json[i]=="告警"){
										tr=tr+'<tr><td class="error" style="color:rgb(0,181,0);width:35px;">'+json[i]+'</td>';
									}}}
								}
								if((i+1)%3==2){
									tr=tr+'<td>'+json[i]+'</td>';
								}
							}
							
							$("#addtbody").append(tr);
						}
					});
				}
				
				if ($("#bar-chart").length) {
					console.log("chang site");
					interval1=setInterval("showbar()", 2000);	
				}

				/* end bar chart */

				/* pie chart */

				if ($('#pie-chart').length) {

					$.ajax( {
						type : "GET",
						url : getRootPath() + "/api/v1/ztree/ztree/piechart",
						cache : false,
						async : false,
						success : function(data) {
							var json = eval('(' + data + ')'); 
							
							var tmp1 = new Array();
							var tmp2 = new Array();
							tmp1 = json[0].split("/");
							tmp2 = json[1].split("/");
							var data_pie = [];
							for(var i = 0; i < tmp1.length; i++){
								data_pie[i] = {
									label : tmp1[i],
									data : tmp2[i]
								}
							}

					$.plot($("#pie-chart"), data_pie, {
								series : {
									pie : {
										show : true,
										innerRadius : 0.4,
										radius : 1,
										label : {
											show : true,
											radius : 2/ 3,
											formatter : function(label, series) {
												return '<div style="font-size:11px;text-align:center;padding:4px;color:white;" title="'+ label +'">' + label.substring(0,4) + '<br/>' + Math.round(series.percent) + '%</div>';
											},
											threshold : 0.05
										}
									}
								},
								legend : {
									show : true,
									noColumns : 1, // number of colums in legend table
									labelFormatter : null, // fn: string -> string
									labelBoxBorderColor : "#000", // border color for the little label boxes
									container : null, // container (as jQuery object) to put legend in, null means default on top of graph
									position : "ne", // position of default legend container within plot
									margin : [5, 10], // distance from grid edge to default legend container within plot
									backgroundColor : "#efefef", // null means auto-detect
									backgroundOpacity : 1 // set to 0 to avoid background
								},
								grid : {
									hoverable : true,
									clickable : true
								},
					});
                    },
						error :function(data){
						
						}
					});
				}

				/* end pie chart */

				/* site stats chart */
				if($("#site-stats").length){
					//console.log("chang site");
					interval=setInterval("showsite()", 2000);	
				}	

			}
			/* end flot charts */

		</script>
		
<script type="text/javascript">
    $(document).ready(
        setTimeout('centerLogicFlesh()', 2000)
	    );
	    function centerLogicFlesh() {
	        if (parent.center_name_click != '') {
	            var centerNode11 = '.ztree-center p:contains(' + parent.center_name_click + ')';
	            var center11 = $(centerNode11).parent();
	            center11.trigger("click");
	            $('#tree .center-service').hide();
	            center11.next().show();
	        }
	    }
</script>

</body>
</html>